<script type="text/javascript">
    // works with 1 row

    const original = [
        ['a', 'b', 'c', 'd'],
        ['e', 'f', 'g', 'h'],
        ['i', 'j', 'k', 'l'],
        ['m', 'n', 'o', 'p']
    ];

    const panelDefinitions = {
        '2x2_top_left': [
            [0, 1],
            [3, 2]
        ],
        '2x2_bottom_right': [
            [2, 3],
            [1, 0]
        ],
        '3x2_bottom_right': [
            [3, 4, 5],
            [2, 1, 0]
        ]
    };

    const mapping = [
        [
            { used_panel: '2x2_top_left', group: 'A', order_in_group: 2 },
            // { used_panel: '3x2_bottom_right', group: 'A', order_in_group: 1 },
            { used_panel: '2x2_bottom_right', group: 'A', order_in_group: 1 },
        ],
        // [
        //     { used_panel: '2x2_bottom_right', group: 'A', order_in_group: 3 },
        //     // { used_panel: '3x2_bottom_right', group: 'A', order_in_group: 1 },
        //     { used_panel: '2x2_bottom_right', group: 'B', order_in_group: 1 },
        // ]
    ];

    let flattenedPanelMapping = [];
    let ledGroupValues = {};
    for(let varPanelsRow = 0; varPanelsRow < mapping.length; varPanelsRow++) {
        let currentPanelRow = mapping[varPanelsRow];
        let globalOffsetColTarget = [0];
        for(let varPanelsRowPanel = 0; varPanelsRowPanel < currentPanelRow.length; varPanelsRowPanel++) {
            let currentPanel = currentPanelRow[varPanelsRowPanel];
            let currentPanelLayout = panelDefinitions[currentPanel['used_panel']];
            // console.log('currentPanelLayout', currentPanelLayout);


            for(let varLocalRow = 0; varLocalRow < currentPanelLayout.length; varLocalRow++) {
                let currentPanelLayoutRow = currentPanelLayout[varLocalRow];
                for(let varLocalCol = 0; varLocalCol < currentPanelLayoutRow.length; varLocalCol++) {
                    let currentPanelLayoutRowCell = currentPanelLayoutRow[varLocalCol];
                    let localOffsetColTarget = globalOffsetColTarget[varPanelsRowPanel] + varLocalCol;



                    // flattenedPanelMapping is not really necessary
                    console.log(
                        'currentPanelLayoutRowCell',
                        'g' + currentPanel['group'] + '_o' + currentPanel['order_in_group'],
                        // globalOffsetColTarget[varPanelsRowPanel],
                        localOffsetColTarget,
                        '|',
                        'row'+varLocalRow,
                        'col'+varLocalCol,
                        currentPanelLayoutRowCell,
                        ' > ',
                        original[varLocalRow][localOffsetColTarget]
                    );
                    if(typeof flattenedPanelMapping[varLocalRow] === 'undefined') {
                        flattenedPanelMapping[varLocalRow] = {};
                    }
                    flattenedPanelMapping[varLocalRow][localOffsetColTarget] =
                        'g' + currentPanel['group'] + '_o' + currentPanel['order_in_group'] + ' ' +
                        varLocalRow + '_' +
                        currentPanelLayoutRowCell + ' ' +
                        original[varLocalRow][localOffsetColTarget];



                    if (!ledGroupValues[currentPanel['group']]) {
                        ledGroupValues[currentPanel['group']] = {};
                    }
                    if (!ledGroupValues[currentPanel['group']][currentPanel['order_in_group']]) {
                        ledGroupValues[currentPanel['group']][currentPanel['order_in_group']] = {};
                    }
                    ledGroupValues[currentPanel['group']][currentPanel['order_in_group']][currentPanelLayoutRowCell] = original[varLocalRow][localOffsetColTarget];
                }
            }

            globalOffsetColTarget[varPanelsRowPanel+1] = globalOffsetColTarget[varPanelsRowPanel] + currentPanelLayout[0].length;
        }
    }

    console.log(flattenedPanelMapping);
    console.log(ledGroupValues);


</script>
