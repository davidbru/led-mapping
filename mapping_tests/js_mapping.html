<script type="text/javascript">
    // works with multiple row

    const original = [
        ['a', 'b', 'c', 'd'],
        ['e', 'f', 'g', 'h'],
        ['i', 'j', 'k', 'l'],
        ['m', 'n', 'o', 'p'],
        ['q', 'r', 's', 't']
    ];

    const panelDefinitions = {
        '2x2_top_left': [
            [0, 1],
            [3, 2]
        ],
        '2x2_bottom_right': [
            [2, 3],
            [1, 0]
        ],
        '3x2_bottom_right': [
            [3, 4, 5],
            [2, 1, 0]
        ],
        '2x3_top_left': [
            [0, 1],
            [5, 2],
            [4, 3]
        ],
        '2x3_bottom_left': [
            [4, 3],
            [5, 2],
            [0, 1]
        ],
    };

    const mapping = [
        [
            { used_panel: '2x3_top_left', gpioPin: 2, orderInGpioPinGroup: 2 },
            { used_panel: '2x3_bottom_left', gpioPin: 3, orderInGpioPinGroup: 2 },
        ],
        [
            { used_panel: '2x2_bottom_right', gpioPin: 2, orderInGpioPinGroup: 3 },
            { used_panel: '2x2_top_left', gpioPin: 3, orderInGpioPinGroup: 1 },
        ]
    ];

    let ledGroupValues = {};
    let currentPanelsRowHeight = 0;
    let globalOffsetRowTarget = [0];
    for(let varPanelsRow = 0; varPanelsRow < mapping.length; varPanelsRow++) {
        let currentPanelRow = mapping[varPanelsRow];
        let globalOffsetColTarget = [0];
        for(let varPanelsRowPanel = 0; varPanelsRowPanel < currentPanelRow.length; varPanelsRowPanel++) {
            let currentPanel = currentPanelRow[varPanelsRowPanel];
            let currentPanelLayout = panelDefinitions[currentPanel['used_panel']];
            currentPanelsRowHeight = currentPanelLayout.length

            for(let varLocalRow = 0; varLocalRow < currentPanelLayout.length; varLocalRow++) {
                let currentPanelLayoutRow = currentPanelLayout[varLocalRow];
                let localOffsetRowTarget = globalOffsetRowTarget[varPanelsRow] + varLocalRow;
                for(let varLocalCol = 0; varLocalCol < currentPanelLayoutRow.length; varLocalCol++) {
                    let currentPanelLayoutRowCell = currentPanelLayoutRow[varLocalCol];
                    let localOffsetColTarget = globalOffsetColTarget[varPanelsRowPanel] + varLocalCol;


                    if (!ledGroupValues[currentPanel['gpioPin']]) {
                        ledGroupValues[currentPanel['gpioPin']] = {};
                    }
                    if (!ledGroupValues[currentPanel['gpioPin']][currentPanel['orderInGpioPinGroup']]) {
                        ledGroupValues[currentPanel['gpioPin']][currentPanel['orderInGpioPinGroup']] = {};
                    }
                    ledGroupValues[currentPanel['gpioPin']][currentPanel['orderInGpioPinGroup']][currentPanelLayoutRowCell] = original[localOffsetRowTarget][localOffsetColTarget];
                }
            }

            globalOffsetColTarget[varPanelsRowPanel+1] = globalOffsetColTarget[varPanelsRowPanel] + currentPanelLayout[0].length;
        }

        globalOffsetRowTarget[varPanelsRow+1] = globalOffsetRowTarget[varPanelsRow] + currentPanelsRowHeight;
    }
    console.log('ledGroupValues', ledGroupValues);

    // Flatten the LedGroupValues for outputting it to the LED-Stripe
    const ledStripeValuesFlattened = Object.fromEntries(
        Object.entries(ledGroupValues).map(([group, sections]) => [
            group,
            Object.values(sections)
                .flatMap(section => Object.values(section))
        ])
    );
    console.log('ledStripeValuesFlattened', ledStripeValuesFlattened);
</script>
